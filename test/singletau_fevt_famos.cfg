process PROD  = 
{

    # The number of events to be processed.
    untracked PSet maxEvents = {untracked int32 input = 2000}
    
    # include "FastSimulation/Configuration/data/CommonInputsFake.cff"

    service =  RandomNumberGeneratorService {
	untracked uint32 sourceSeed = 1234
	# This is to initialize the random engine of Famos
	# Watch out! This works only if the FamosProducer label is "famosSimHits"
	PSet moduleSeeds =
	{
	    untracked uint32 VtxSmeared = 223458
#	    untracked uint32 famosSimHits = 23579
	    untracked uint32 famosPileUp = 918273
	    untracked uint32 famosSimHits = 235791312
	    untracked uint32 siTrackerGaussianSmearingRecHits = 34680
	    untracked uint32 caloRecHits = 754321
	}
    }
    
    source = PythiaSource 
    {
	untracked bool pythiaVerbosity = false
	#  possibility to run single or double back-to-back particles with PYTHIA
	# if ParticleID = 0, run PYTHIA
	untracked int32 ParticleID = -15
	untracked bool DoubleParticle = false
	untracked double Ptmin = 50. 
	untracked double Ptmax = 50.0001
	untracked double Etamin = 0. 
	untracked double Etamax = 1
	untracked double Phimin = 0. 
	untracked double Phimax = 360.
	
	PSet PythiaParameters = 
	{
	    # This is a vector of ParameterSet names to be read, in this order
	    vstring parameterSets = 
	    {
		"pythiaUESettings",
		"pythiaTauJets"
	    }
	    
	    # CMS default pythia parameters
	    # (Not very relevant, since no underlying event).
	    include "Configuration/Generator/data/PythiaUESettings.cfi"
	    
	    # Tau jets (configuration by A. Nikitenko)
	    vstring pythiaTauJets = 
	    {
		'MDME(89,1)=0      ! no tau->electron',
		'MDME(90,1)=0      ! no tau->muon'
	    }
	}
    }
    
    
    
    # Famos sequences
    include "FastSimulation/Configuration/data/FamosSequences.cff"
    replace VolumeBasedMagneticFieldESProducer.useParametrizedTrackerField = true
    replace famosSimHits.SimulateCalorimetry = true
    replace famosSimHits.SimulateTracking = true
    replace famosPileUp.PileUpSimulator.averageNumber = 0.0

#    replace famosSimHits.MaterialEffects.PairProduction = false
#    replace famosSimHits.MaterialEffects.Bremsstrahlung = false
#    replace famosSimHits.MaterialEffects.EnergyLoss = false
#    replace famosSimHits.MaterialEffects.MultipleScattering = false
#    replace famosSimHits.MaterialEffects.NuclearInteraction = false

    
    replace famosSimHits.VertexGenerator.SigmaX = 0.00001
    replace famosSimHits.VertexGenerator.SigmaY = 0.00001
    replace famosSimHits.VertexGenerator.SigmaZ = 0.00001

#    replace famosSimHits.ParticleFilter.forbiddenPdgCodes = {22}

    # replace particleFlowBlock.verbose = true
    # replace particleFlow.verbose = true

    # replace particleFlowCluster.clustering_Hcal_CaloTowers = false

    module dump = EventContentAnalyzer {}

    path p1 = { 
	famosWithCaloTowersAndParticleFlow,
	caloJetMetGen,
	particleFlowSimParticle
    }
    
    module o1 = PoolOutputModule { 
	untracked string fileName = "blocks_famos.root" 
	untracked vstring outputCommands = 
	{
            "drop *",
            "keep recoPFRecHits_*_*_*",
            "keep recoPFClusters_*_*_*",
            "keep recoPFRecTracks_*_*_*",
	    "keep recoPFBlocks_particleFlowBlock_*_*",
	    "keep recoPFCandidates_particleFlow_*_*",
            "keep recoPFSimParticles_*_*_*",
	    "keep recoCandidatesOwned_*_*_*",
            "keep recoTracks_*_*_*",
	    "keep recoCaloJets_*_*_*",
	    "keep CaloTowersSorted_*_*_*",
	    "keep edmHepMCProduct_*_*_*"	    
	}
    }

    include "FastSimulation/Configuration/data/EventContent.cff"
    module aod = PoolOutputModule {
	untracked string fileName = "aod_famos.root" 
	using AODEventContent
    }


    endpath outpath = {o1, aod}
    
    # Keep the logging output to a nice level #
    include "FWCore/MessageService/data/MessageLogger.cfi"
}		
